# Negotiation Lab (Classroom Experiment)

A fast, classroom-ready multi-issue negotiation experiment built with Next.js App Router + TypeScript. It supports consent, negotiation, chat, structured offers, a post-game survey, and full session logging for analysis.

## Features
- Multi-issue bargaining UI with offer builder + history
- Neutral vs persona agent language (Gemini proxy, numeric offers stay server-controlled)
- Consent + demographics + survey flow
- Session logging with export and server-side storage
- Admin page for reviewing saved sessions

## Tech Stack
- Next.js (App Router), React, TypeScript
- TailwindCSS + shadcn/ui
- Zustand for state
- React Hook Form + Zod for validation
- Gemini (server-side proxy only)

## Setup
1) Install dependencies:
```bash
npm install
```

2) Configure env:
```bash
# .env.local
GOOGLE_AI_STUDIO_API_KEY=YOUR_KEY_HERE
NEXT_PUBLIC_MOCK_MODE=true
ADMIN_USER=admin
ADMIN_PASSWORD=admin
```

3) Run the dev server:
```bash
npm run dev
```

Open http://localhost:3000

## Admin Logs
- Logs are saved to `data/` on the machine running the server.
- Admin UI: http://localhost:3000/admin (Basic Auth).
- Download JSON per session from the admin page.

## Scripts
- `npm run test:gemini` — check Gemini connectivity.
- `npm run test:personas` — compare persona outputs on the same prompt.

## How Negotiation Works
- Issues are configured in `lib/config.ts`.
- The agent offer is generated by a strategy stub (`mockAgentOffer`), not the LLM.
- Gemini only produces chat framing for persona mode.

## Deployment for a Short Classroom Window
### Option A (same Wi‑Fi)
- Run locally with `npm run dev`.
- Share your machine IP: `http://YOUR-IP:3000`.
- All logs are stored locally in `data/`.

### Option B (public link for a few hours)
- Use a tunnel (Cloudflare Tunnel or ngrok) pointed at your local server.
- Keep the server running for the session.
- Logs remain in your local `data/` folder.

### Option C (hosted)
- Use a host with persistent disk (Render, Fly, Railway with volume). 
- If deploying to a serverless host, logs will **not** persist unless you switch `/api/submit` to a database.

## Important Notes
- `.env.local` is ignored by git so your API key is never committed.
- Change `ADMIN_USER` / `ADMIN_PASSWORD` before sharing the admin page publicly.

## License
Internal classroom project.
